traits:
  PostgreSQL: true

scripts:

  create-database:
    body: |
      #!/usr/bin/env bash
      set -eux
      cd $LEIHS_DATABASE_DIR
      createdb "$DATABASE_NAME"
      psql -d "$DATABASE_NAME" -f db/structure.sql

  test:
    start_when:
      database created:
        script_key: create-database
        states: [passed]

  delete-database:
    body: |
      #!/usr/bin/env bash
      set -eux
      cd $LEIHS_DATABASE_DIR
      dropdb "$DATABASE_NAME"
    start_when:
      test is finished:
        script_key: test
        states: [aborted, defective, passed, failed, skipped]
